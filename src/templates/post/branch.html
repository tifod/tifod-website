{% set children = post['children'] %}

<div class="post-siblings">
    {# nav bar #}
    {% if children|length > 1 %}
        <div class="prev"><i class="fa fa-chevron-left fa-2x"></i></div>
        <div class="next"><i class="fa fa-chevron-right fa-2x"></i></div>
        <div class="post-siblings-nav">
            <form>
                {% for t_child in children %}
                    <label class="link" data-target="{{ t_child['id'] }}">
                        <input type="radio" id="{{ t_child['id'] }}-radio-button" name="radio-{{ post['id'] }}" {% if loop.first %}checked{% endif %} />
                        <div class="link-btn"></div>
                    </label>
                {% endfor %}
            </form>
        </div>
    {% endif %}
    
    {# posts #}
    <div class="posts{% if children|length > 1 %} many-posts{% endif %}">
    {% for child in children%}
        {% set lastChild = children[children|length - 1] %}        
        <div>
            <input class="post-checkbox" id="{{ child['id'] }}-post-checkbox" type="checkbox">
            <div class="post{% if loop.first %} active-post{% endif %}" id="{{ child['id'] }}" data-path="{{ child['path'] }}">
        
                {# content #}
                <label for="{{ child['id'] }}-post-checkbox" class="post-more-label">
                    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/public/img/post/{% if child['remakes'][0]['has_pin'] == 1 %}{{ child['remakes'][0]['content'] }}{% else %}{{ child['content'] }}{% endif %}">
                </label>
            </div>
            <div class="post-more">
                <label for="{{ child['id'] }}-post-checkbox"></label>
                <div class="post-more-content">
                    <div>
                        {# exit button #}
                        <label for="{{ child['id'] }}-post-checkbox" class="exit-btn"><i class="fa fa-times fa-2x"></i></label>
                        
                        <div class="post-preview">
                            <img src="/public/img/post/{{ child['content'] }}">
                        </div>
                        
                        {# author and time ago #}
                        <p>
                            <a href="/u/{{ child['author_name']|lower }}">{{ child['author_name'] }}</a>
                            <span>, {{ child['posted_on']|timeago }}</span>
                        </p>
                        
                        <p class="list-inline">
                            <button onclick="ajaxPingUrl('/togglePin/{{ child['id'] }}',this,updatePin)" data-unpin="<i class='fa fa-thumb-tack'></i> Enlever l'épingle de ce post" data-repin="<i class='fa fa-thumb-tack'></i> Reépingler ce post" >{% if child['has_pin'] %}<i class='fa fa-thumb-tack'></i> Enlever l'épingle de ce post{% else %}<i class='fa fa-thumb-tack'></i> Epingler ce post{% endif %}</button>
                            
                            <button onclick="ajaxPingUrl('/vote/minus/{{ child['id'] }}',this,updateScore)">-</button>
                            <span class="post-score">{{ child['score_result'] }} pts</span>
                            <button onclick="ajaxPingUrl('/vote/plus/{{ child['id'] }}',this,updateScore)">+</button>
                            <span class="post-percent">({{ child['score_percent'] }}%)</span>
                        </p>
                        <p class="list-inline">
                            <i class='fa fa-undo fa-fw'></i> <a href="/resetPostScore/{{ child['id'] }}?redirect=/p/{{ projectId }}">Remettre le score à zéro</a>
                            <i class='fa fa-trash'></i> <a href="/delete-post/{{ child['id'] }}?redirect=/p/{{ projectId }}">Supprimer ce post</a>
                            <i class='fa fa-code-fork fa-flip-vertical'></i> <a href="#{{ child['id'] }}-post-tree" class="tree-link" data-postid="{{ child['id'] }}" data-scroll>Voir dans l'arborescence du projet</a>
                        </p>
                    </div>
                    {# remakes #}
                    <div>
                        {% set remakes = child['remakes'] %}
                        {% if remakes %}
                            {% for remake in remakes %}
                                <div class="post-preview">
                                    <img src="/public/img/post/{{ remake['content'] }}">
                                </div>
                                <div>
                                    <p class="list-inline">
                                        <button onclick="ajaxPingUrl('/togglePin/{{ remake['id'] }}',this,updatePin)" data-unpin="<i class='fa fa-thumb-tack'></i> Enlever l'épingle de ce post" data-repin="<i class='fa fa-thumb-tack'></i> Reépingler ce post" >{% if remake['has_pin'] %}<i class='fa fa-thumb-tack'></i> Enlever l'épingle de ce post{% else %}<i class='fa fa-thumb-tack'></i> Epingler ce post{% endif %}</button>
                                        
                                        <button onclick="ajaxPingUrl('/vote/minus/{{ remake['id'] }}',this,updateScore)">-</button>
                                        <span class="post-score">{{ remake['score_result'] }} pts</span>
                                        <button onclick="ajaxPingUrl('/vote/plus/{{ remake['id'] }}',this,updateScore)">+</button>
                                        <span class="post-percent">({{ remake['score_percent'] }}%)</span>
                                    </p>
                                    <p class="list-inline">
                                        <i class='fa fa-undo fa-fw'></i> <a href="/resetPostScore/{{ remake['id'] }}?redirect=/p/{{ projectId }}">Remettre le score à zéro</a>
                                        <i class='fa fa-trash'></i> <a href="/delete-post/{{ remake['id'] }}?redirect=/p/{{ projectId }}">Supprimer ce post</a>
                                    </p>
                                </div>
                            {% endfor %}
                        {% else %}
                            <i>Il n'y a pas de remakes</i>
                        {% endif %}
                    </div>
                    {# add content #}
                    <div class="add-content-btn">
                        <a href="#{{ child['id'] }}-add-content" class="mdl-button mdl-js-button mdl-button--fab mdl-button--accent">
                            <i class="material-icons">add</i>
                        </a>
                    </div>
                    <div id="{{ child['id'] }}-add-content">
                        {% include "post/add-content.html" %}
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
    </div>
</div>

{# post children #}
{% for child in children%}
    {% if child['children'] %}
        <div class="post-level{% if loop.first %} active-level{% endif %}" id="{{ child['id'] }}-children">
                {% include "post/branch.html" with {'post': child} %}
        </div>
    {% endif %}
{% endfor %}